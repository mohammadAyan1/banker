import{j as e,a as o,h as W,a1 as z,i as K,k as Q,ah as $,V as c,ai as q,aj as J,ak as X,al as Z,aa as _}from"./index-Cwaqwj_s.js";import{d as D}from"./dayjs.min-C8iS-mZo.js";import{I as ee}from"./ImageUploader-BVnbHuqI.js";import{G as te}from"./GeoLocationInput-7V-fa_jL.js";import{F as s}from"./index-DmJzFToF.js";import{D as P}from"./index-C4Qn9Q8l.js";import{I as n}from"./index-Co5CSDrC.js";import{T as h}from"./index-Vg__3N59.js";import{S as T}from"./index-BAYHenB6.js";import{C as V}from"./index-BQnvoT-3.js";import{B as w}from"./button-CRiyqN-T.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./FileSaver.min-DVxi4_QD.js";import"./index-BtVXgsBD.js";import"./index-D6eF6qyz.js";import"./isVisible-DhUEo0yb.js";import"./index-3NS6t-ya.js";import"./fade-ZXlAHFga.js";import"./compact-item-9bHwfI2_.js";import"./useForceUpdate-uYG1hq1o.js";import"./EyeOutlined-CexqOR59.js";import"./roundedArrow-BrpLF90m.js";import"./CloseCircleFilled-079ZkidS.js";import"./index-IOLSlQ-g.js";import"./index-C8XweYY5.js";import"./InfoCircleFilled-ChY3wmgV.js";import"./index-CUiJDIVs.js";import"./PurePanel-CY_QmN-T.js";import"./useBreakpoint-Co8dBcnG.js";import"./useVariants-Dzz7aYiE.js";import"./TextArea-BkFj_DI7.js";const ae=({visible:l,onConfirm:i,onCancel:m})=>l?e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Are you sure?"}),e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"Please double-check all the details before submitting this report."}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 rounded bg-gray-300 hover:bg-gray-400",children:"No"}),e.jsx("button",{onClick:i,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Yes, Submit"})]})]})}):null,{TextArea:F}=n,{Option:f}=T,we=()=>{const[l]=s.useForm(),[i,m]=o.useState({dateOfVisit:"",dateOfReport:"",propertyAddress:"",visitedPersonName:"",contactNumber:"",constructionStage:"",constructionPercentage:"",constructionAsPer:"",total:"",areaRemarks:"",latitude:"",longitude:"",overallStatus:"",negativeReason:"",certificateText:"THIS IS TO CERTIFY THAT, I HAVE VISITED CONSTRUCTION SITE AS PER ABOVE ADDRESS AND FOUND IT COMPLIANT TO THE BYELAWS / PLANS PROVIDED.",charges:"",gstPercentage:"",totalAmount:"",declaration1:!0,declaration2:!0,declaration3:"",sitePics:[]}),{user:p}=W(a=>a.auth),[x,O]=o.useState([]),[L,E]=o.useState(!1),[Y,S]=o.useState([]),[N,U]=o.useState(!1),[A,R]=o.useState(!1),v=o.useRef(),{id:u}=z(),d=K(),j=Q();o.useEffect(()=>{u&&(async()=>{R(!0);try{const t=await d($(u)).unwrap();U(!0);const r={...t,dateOfVisit:t.dateOfVisit?D(t.dateOfVisit):null,dateOfReport:t.dateOfReport?D(t.dateOfReport):null};if(m(r),l.setFieldsValue(r),Array.isArray(t.imageUrls)){const g=t.imageUrls.map((b,G)=>({uid:`server-${G}`,name:b.split("/").pop(),status:"done",url:b}));S(g),O(t.imageUrls)}}catch(t){console.error("Error fetching data:",t),c.error("Failed to load report data")}finally{R(!1)}})()},[u,d,l]),o.useEffect(()=>{if(p.role==="FieldOfficer"){const a=setTimeout(()=>{var t;(t=v.current)==null||t.getLocation()},100);return()=>clearTimeout(a)}},[p.role]);const H=(a,t)=>{m(r=>({...r,...a}))},M=(a,t)=>{l.setFieldsValue({latitude:a,longitude:t}),m(r=>({...r,latitude:a,longitude:t}))},y=async()=>{try{return await l.validateFields(),p.role==="FieldOfficer"&&x.length===0?(c.error("Please upload at least one image"),!1):!0}catch(a){return console.error("Validation failed:",a),!1}},C=async()=>{if(await y()){d(q());try{const t=await l.validateFields(),r={...t,dateOfVisit:t.dateOfVisit?t.dateOfVisit.format("YYYY-MM-DD"):"",dateOfReport:t.dateOfReport?t.dateOfReport.format("YYYY-MM-DD"):"",imageUrls:x};N?(await d(J({id:u,fullData:r})).unwrap(),c.success("Report updated successfully")):(await d(X(r)).unwrap(),c.success("Report submitted successfully")),p.role==="Admin"?j("/"):j("/field/dashboard")}catch(t){c.error(t.message||"An error occurred while submitting")}finally{d(Z())}}},k=async()=>{try{const a=await l.validateFields(),t={...a,dateOfVisit:a.dateOfVisit?a.dateOfVisit.format("YYYY-MM-DD"):"",dateOfReport:a.dateOfReport?a.dateOfReport.format("YYYY-MM-DD"):"",imageUrls:x};await d(_({id:u,bankName:"HomeFirstTrench",updateData:t})).unwrap(),c.success("Case submitted finally!"),j("/")}catch(a){console.error("Final submission failed",a),c.error("Final submission failed")}},B=async()=>{p.role==="FieldOfficer"?await y()&&E(!0):C()},I=()=>{const a=parseFloat(i.charges)||0,t=parseFloat(i.gstPercentage)||0,r=a*(t/100),g=a+r;l.setFieldsValue({totalAmount:g.toFixed(2)}),m(b=>({...b,totalAmount:g.toFixed(2)}))};return o.useEffect(()=>{I()},[i.charges,i.gstPercentage]),e.jsxs("div",{className:"w-full border p-6 bg-white rounded-lg shadow-md",children:[e.jsx(ae,{visible:L,onCancel:()=>E(!1),onConfirm:C,title:"Confirm Submission",message:"Are you sure you want to submit this report? This action cannot be undone."}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:N?"Edit Trench Report":"Create New Trench Report"}),e.jsxs(s,{form:l,layout:"vertical",onValuesChange:H,initialValues:i,className:"space-y-6",children:[e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"1. VENDOR VISIT DETAILS"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s.Item,{label:"DATE OF VISIT",name:"dateOfVisit",children:e.jsx(P,{className:"w-full",format:"YYYY-MM-DD"})}),e.jsx(s.Item,{label:"DATE OF REPORT",name:"dateOfReport",children:e.jsx(P,{className:"w-full",format:"YYYY-MM-DD"})})]}),e.jsx(s.Item,{label:"Address of Property (As per site)",name:"propertyAddress",children:e.jsx(F,{rows:3})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s.Item,{label:"NAME OF THE PERSON WHO VISITED THE SITE",name:"visitedPersonName",children:e.jsx(n,{})}),e.jsx(s.Item,{label:"CONTACT NUMBER",name:"contactNumber",children:e.jsx(n,{type:"tel"})})]})]}),e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"2. CONSTRUCTION"}),e.jsx(s.Item,{label:"CONSTRUCTION STAGE (AS PER SITE)",name:"constructionStage",tooltip:"FOUNDATION / PLINTH / RCC / BRICK WORK / PLASTER / TILING / INTERNAL FINISHING / COMPLETED",children:e.jsx(n,{})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s.Item,{label:"CONSTRUCTION (%)",name:"constructionPercentage",children:e.jsx(h,{className:"w-full"})}),e.jsx(s.Item,{label:"CONSTRUCTION IS AS PER",name:"constructionAsPer",children:e.jsxs(T,{children:[e.jsx(f,{value:"PROVIDED PLANS",children:"PROVIDED PLANS"}),e.jsx(f,{value:"BYELAWS",children:"BYELAWS"}),e.jsx(f,{value:"BOTH",children:"BOTH"})]})})]})]}),e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"3. AREA"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s.Item,{label:"TOTAL CONSIDERED ON SITE (IN SQ.FT)",name:"total",children:e.jsx(h,{className:"w-full",min:0})}),e.jsx(s.Item,{label:"REMARKS",name:"areaRemarks",children:e.jsx(n,{})})]}),e.jsx(te,{ref:v,onLocationChange:M,initialLat:i.latitude,initialLng:i.longitude}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s.Item,{label:"OVERALL STATUS",name:"overallStatus",children:e.jsxs(T,{children:[e.jsx(f,{value:"POSITIVE",children:"POSITIVE"}),e.jsx(f,{value:"NEGATIVE",children:"NEGATIVE"})]})}),e.jsx(s.Item,{label:"IF NEGATIVE, PLEASE SPECIFY THE REASON",name:"negativeReason",children:e.jsx(n,{disabled:i.overallStatus!=="NEGATIVE"})})]})]}),e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"4. CERTIFICATE"}),e.jsx(s.Item,{name:"certificateText",children:e.jsx(F,{rows:4})})]}),e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"5. BILLING"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(s.Item,{label:"CHARGES",name:"charges",children:e.jsx(h,{className:"w-full",min:0,onChange:I})}),e.jsx(s.Item,{label:"GST % (IF APPLICABLE)",name:"gstPercentage",children:e.jsx(h,{className:"w-full",min:0,max:100,onChange:I})}),e.jsx(s.Item,{label:"TOTAL",name:"totalAmount",children:e.jsx(h,{className:"w-full",readOnly:!0})})]})]}),e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"6. DECLARATION"}),e.jsx(s.Item,{name:"declaration1",valuePropName:"checked",children:e.jsx(V,{children:"We have no direct or indirect interest in the property valued."})}),e.jsx(s.Item,{name:"declaration2",valuePropName:"checked",children:e.jsx(V,{children:"The property was inspected by our authorized representative and info is true."})}),e.jsx(s.Item,{label:"Additional Declaration",name:"declaration3",children:e.jsx(n,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(s.Item,{label:"LATITUDE",name:"latitude",children:e.jsx(n,{readOnly:!0})}),e.jsx(s.Item,{label:"LONGITUDE",name:"longitude",children:e.jsx(n,{readOnly:!0})})]}),e.jsxs("div",{className:"pb-6",children:[e.jsx("h2",{className:"bg-blue-100 p-3 font-bold mb-4 rounded-lg",children:"7. SITE PHOTOS"}),e.jsx(ee,{deleteId:u,images:Y,setImages:S,setUploadedUrls:O,maxCount:10})]}),e.jsxs("div",{className:"mt-6 text-right",children:[e.jsx(w,{type:"primary",size:"large",onClick:B,loading:A,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-lg mr-5",children:N?"Update Report":"Submit Report"}),e.jsx(w,{type:"primary",size:"large",loading:A,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg text-lg ",onClick:k,children:"Final Submit"})]})]})]})};export{we as default};
