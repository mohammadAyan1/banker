import{c as E,i as T,k as D,h as y,a as d,cG as F,j as s,cH as $,V as w,cI as U,cJ as z,S as V,O as q,cK as K}from"./index-Cwaqwj_s.js";import{d as S}from"./dayjs.min-C8iS-mZo.js";import{C as H}from"./index-DDeIeEke.js";import{T as j}from"./index-7APy03P_.js";import{F as J}from"./Table-CLq92ETG.js";import{M as W}from"./index-C8XweYY5.js";import{B as v}from"./button-CRiyqN-T.js";import{I as X}from"./index-Co5CSDrC.js";import"./EllipsisOutlined-DayKtJs5.js";import"./index-D6eF6qyz.js";import"./isVisible-DhUEo0yb.js";import"./useVariants-Dzz7aYiE.js";import"./PlusOutlined-DfbQOCuQ.js";import"./index-IOLSlQ-g.js";import"./roundedArrow-BrpLF90m.js";import"./compact-item-9bHwfI2_.js";import"./styleChecker-2XBKVxNa.js";import"./addEventListener-Dl-2Ckbu.js";import"./index-BAYHenB6.js";import"./PurePanel-CY_QmN-T.js";import"./TextArea-BkFj_DI7.js";import"./CloseCircleFilled-079ZkidS.js";import"./index-BQnvoT-3.js";import"./LeftOutlined-B-JC9k9Z.js";import"./index-3NS6t-ya.js";import"./index-DkHp6hjz.js";import"./useBreakpoint-Co8dBcnG.js";import"./useForceUpdate-uYG1hq1o.js";import"./Pagination-DR-FJqzx.js";import"./InfoCircleFilled-ChY3wmgV.js";import"./index-CUiJDIVs.js";import"./fade-ZXlAHFga.js";import"./EyeOutlined-CexqOR59.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],ee=E("check-check",Z);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],se=E("eye",te),ae=({caseId:i,onSuccess:r})=>{const u=T(),A=D(),{notes:a}=y(c=>(c==null?void 0:c.notes)||[]),[o,p]=d.useState("");d.useEffect(()=>{u(F(i))},[i,u]);const g=async c=>{c.preventDefault();try{await u($({caseId:i,message:o})).unwrap(),p(""),A(0),w.success("Note added successfully"),r&&r()}catch(N){console.error("Failed to add note:",N)}};return s.jsx("div",{className:"space-y-3",children:s.jsxs("form",{onSubmit:g,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:o,onChange:c=>p(c.target.value),placeholder:"Add note...",className:"border p-2 flex-1 rounded"}),s.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Add"})]})})},{Search:Ye}=X,re=[{title:"Total Assigned",value:"TOTAL_ASSIGNED"},{title:"Pending for Approval",value:"PENDING_FOR_APPROVAL"},{title:"Query Raised",value:"QUERY_RAISED"},{title:"Action Pending",value:"ACTION_PENDING"}],Fe=()=>{var b;const i=T(),{user:r}=y(e=>e.auth),{cases:u,loading:A}=y(e=>e.case)||{},a=u,{allCase:o}=y(e=>(e==null?void 0:e.notes)||{}),[p,g]=d.useState(null),[c,N]=d.useState(!1),[l,ne]=d.useState(""),[x,L]=d.useState("TOTAL_ASSIGNED"),[h,O]=d.useState(null),P=D();d.useEffect(()=>{r!=null&&r._id&&(i(U(r._id)),i(z()))},[i,r==null?void 0:r._id]);const R=[...new Set(a==null?void 0:a.map(e=>e.bankName).filter(Boolean))],M=async(e,t)=>{try{await i(K({id:e,bankName:t})).unwrap(),w.success("Case accepted successfully"),P(0)}catch(n){console.log(n)}},f=e=>S(e).isSame(S(),"day"),B=[...((b=(()=>{let e=a;if(x!=="TOTAL_ASSIGNED"){if(x==="QUERY_RAISED")return o==null?void 0:o.filter(t=>t.addedBy===r._id);e=e==null?void 0:e.filter(t=>t.status===x)}return h&&(e=e==null?void 0:e.filter(t=>t.bankName===h)),e})())==null?void 0:b.filter(e=>{var t,n,m,C,_,I,k;return l?((t=e.bankName)==null?void 0:t.toLowerCase().includes(l))||((n=e.customerName)==null?void 0:n.toLowerCase().includes(l))||((m=e.applicantName)==null?void 0:m.toLowerCase().includes(l))||((C=e.addressLegal)==null?void 0:C.toLowerCase().includes(l))||((_=e.address)==null?void 0:_.toLowerCase().includes(l))||((I=e.customerNo)==null?void 0:I.toLowerCase().includes(l))||((k=e.contactPersonNumber)==null?void 0:k.toLowerCase().includes(l)):!0}))||[]].sort((e,t)=>{const n=e.createdAt?f(e.createdAt):!1,m=t.createdAt?f(t.createdAt):!1;return n&&!m?-1:!n&&m?1:0}),G={TOTAL_ASSIGNED:a==null?void 0:a.length,PENDING_FOR_APPROVAL:a==null?void 0:a.filter(e=>e.status==="PENDING_FOR_APPROVAL").length,QUERY_RAISED:o==null?void 0:o.filter(e=>e.addedBy===r._id).length,ACTION_PENDING:a==null?void 0:a.filter(e=>e.status==="ACTION_PENDING").length},Q=[{title:"Bank",dataIndex:"bankName",key:"bankName",sorter:(e,t)=>e.bankName.localeCompare(t.bankName)},{title:"Customer Name",dataIndex:"customerName",key:"customerName",render:(e,t)=>s.jsx("span",{className:"text-blue-600 hover:underline",children:t.customerName||t.applicantName||t.visitedPersonName||"N/A"}),sorter:(e,t)=>{const n=e.customerName||e.applicantName||"",m=t.customerName||t.applicantName||"";return n.localeCompare(m)}},{title:"Assigned Date",dataIndex:"createdAt",key:"createdAt",render:e=>s.jsx(j,{color:f(e)?"green":"default",children:S(e).format("DD/MM/YYYY")}),sorter:(e,t)=>new Date(e.createdAt)-new Date(t.createdAt)},{title:"Address",dataIndex:"addressLegal",key:"addressLegal",render:(e,t)=>s.jsx("span",{className:"text-blue-600 hover:underline",children:t.addressLegal||t.address||t.propertyAddress||"N/A"})},{title:"Contact Number",dataIndex:"contactNumber",key:"contactNumber",render:(e,t)=>s.jsx("span",{className:"text-blue-600 hover:underline",children:t.customerNo||t.contactPersonNumber||"N/A"})},{title:"Action",key:"action",dataIndex:"action",render:(e,t)=>(t==null?void 0:t.approvalStatus)==="Pending"?s.jsx(v,{type:"primary",onClick:()=>M(t._id,t.bankName),children:"Accept"}):s.jsxs(q,{to:`${t.route}`,className:"flex gap-3 items-center",children:[s.jsx(se,{className:"text-blue-600 hover:text-blue-800"}),t.isReportSubmitted&&s.jsx(ee,{className:"text-green-500"})]})},{title:"Create Query",dataIndex:"createQuery",key:"createQuery",render:(e,t)=>s.jsx(v,{disabled:(t==null?void 0:t.isReportSubmitted)===!0,type:"default",onClick:()=>{g(t._id),N(!0)},children:"Mark Query"})}],Y=[{title:"Case ID",dataIndex:"caseId",key:"caseId"},{title:"Message",dataIndex:"message",key:"message"}];return s.jsxs("div",{className:"p-4 mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:"My Assigned Cases"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6",children:re.map(({title:e,value:t})=>s.jsxs(H,{hoverable:!0,onClick:()=>L(t),className:`text-center cursor-pointer ${x===t?"border-blue-600 shadow-lg":""}`,children:[s.jsx("div",{className:"text-gray-500 text-sm",children:e}),s.jsx("div",{className:"text-xl font-bold",children:G[t]||0})]},t))}),s.jsx("div",{className:"mb-4",children:s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:R.map(e=>{const t=a.filter(n=>n.bankName===e&&f(n.createdAt)).length;return s.jsxs(j,{color:h===e?"blue":"default",onClick:()=>O(h===e?null:e),className:"cursor-pointer px-3 py-1",children:[e," ",t>0&&`(${t})`]},e)})})}),A?s.jsx("div",{className:"flex justify-center mt-10",children:s.jsx(V,{size:"large"})}):s.jsx(J,{dataSource:B,columns:x==="QUERY_RAISED"?Y:Q,rowKey:e=>e._id||e.caseId,bordered:!0,pagination:{pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`}}),s.jsx(W,{title:"Case Notes",open:c,onCancel:()=>N(!1),footer:null,width:600,children:p&&s.jsx(ae,{caseId:p,onSuccess:()=>N(!1)})})]})};export{Fe as default};
